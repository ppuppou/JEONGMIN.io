---
title: "대구광역시의 취약장소 식별 및 안전도 향상"
author: "8조"
format: revealjs
---
## 서론
```{python}
import pandas as pd
import numpy as np
import re
import matplotlib.pyplot as plt
import plotly.express as px
import plotly.graph_objects as go
import requests
import time
import json
import os
from tqdm import tqdm
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

```

## 1-1. 분석 배경
* 대구시의 범죄율이 꾸준히 증가하고 있으며, 특히 2025년부터 검거율도 감소하고 있어서 이를 해결할 방안의 필요성을 느낌

**<분석내용>**
* 다양한 변수를 활용하여 **범죄 발생이 집중되는 위험지역**을 식별 후, 이를 바탕으로 안전도 향상 방안 도출

## 범죄율 증감추이

```{python}
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from io import StringIO
import platform

# 1. 데이터 준비
# './범죄율 증감.xlsx' 파일에서 데이터를 불러옵니다.
# 파일 경로가 코드 실행 위치와 맞는지 확인해주세요.
try:
    # 사용자가 요청한 대로 Excel 파일에서 데이터를 읽어옵니다.
    df = pd.read_excel('./범죄율 증감.xlsx')
except FileNotFoundError:
    print("오류: './범죄율 증감.xlsx' 파일을 찾을 수 없습니다.")
    print("코드와 같은 폴더에 파일이 있는지 확인해주세요.")
    # 파일이 없을 경우, 빈 데이터프레임을 생성하여 오류를 방지합니다.
    df = pd.DataFrame()


# 데이터가 성공적으로 로드되었을 경우에만 후속 코드를 실행합니다.
if not df.empty:
    # 2. 데이터 전처리
    # 'Unnamed: 0' 컬럼을 인덱스로 설정하고, 불필요한 첫 번째 인덱스 컬럼은 제거합니다.
    # Excel 파일의 첫 번째 열 이름이 다를 경우, 'Unnamed: 0' 부분을 실제 열 이름으로 수정해야 합니다.
    df = df.set_index('Unnamed: 0').iloc[:, 1:]

    # 행과 열을 바꿔서(Transpose) 분기별 데이터를 다루기 쉽게 만듭니다.
    df_t = df.transpose()


    # 3. 시각화 (메시지 강조 버전)
    # 한글 폰트 설정 (Windows, Mac, Linux 환경에 맞게 자동 설정)
    if platform.system() == 'Windows':
        plt.rc('font', family='Malgun Gothic')
    elif platform.system() == 'Darwin': # Mac
        plt.rc('font', family='AppleGothic')
    else: # Linux
        plt.rc('font', family='NanumGothic')

    # 마이너스 기호 깨짐 방지
    plt.rcParams['axes.unicode_minus'] = False

    # 2개의 그래프를 담을 Figure와 Axes 객체를 생성합니다.
    fig, axes = plt.subplots(2, 1, figsize=(12, 14))
    fig.suptitle('분기별 범죄 동향 분석', fontsize=22, y=1.03)

    # --- 그래프 1: 전년 동분기 대비 범죄 발생 증감률 ---
    colors = ['crimson' if x > 0 else 'royalblue' for x in df_t['전년동분기 대비 발생건수 증감률(%)']]
    sns.barplot(x=df_t.index, y=df_t['전년동분기 대비 발생건수 증감률(%)'], ax=axes[0], palette=colors)
    axes[0].set_title('전년 동분기 대비 범죄 발생률은 계속 증가 추세', fontsize=16, pad=20)
    axes[0].set_ylabel('증감률 (%)')
    axes[0].axhline(0, color='grey', linewidth=0.8) # 0% 기준선 추가
    axes[0].grid(axis='y', linestyle='--', alpha=0.6)

    # 막대 위에 값 표시
    for p in axes[0].patches:
        axes[0].annotate(f'{p.get_height()}%', (p.get_x() + p.get_width() / 2., p.get_height()),
                         ha='center', va='center', xytext=(0, 10), textcoords='offset points', fontsize=11)

    axes[0].annotate('24년 3분기를 제외하고\n매 분기 전년 대비 범죄 증가', 
                     xy=(0.95, 0.95), xycoords='axes fraction',
                     ha='right', va='top',
                     bbox=dict(boxstyle='round,pad=0.5', fc='wheat', alpha=0.5),
                     fontsize=13)


    # --- 그래프 2: 검거율 하락 추세 강조 ---
    sns.lineplot(data=df_t['발생건수대비 검거건수(%)'], ax=axes[1], marker='o', color='darkorange', linewidth=2.5)
    axes[1].set_title('증가하는 범죄율과 달리 검거율은 하락세', fontsize=16, pad=20)
    axes[1].set_ylabel('검거율 (%)')
    axes[1].grid(True, linestyle='--', alpha=0.6)

    # 최저점(가장 낮은 검거율)에 텍스트 강조
    min_period = df_t['발생건수대비 검거건수(%)'].idxmin()
    min_value = df_t['발생건수대비 검거건수(%)'].min()
    axes[1].text(min_period, min_value, f'  {min_value}% (최저)', 
                 color='blue', verticalalignment='top', fontsize=12, fontweight='bold')
    
    # 하락 추세 강조를 위한 화살표와 텍스트 추가
    axes[1].annotate('대응 효율성 저하', 
                     xy=(len(df_t)-2, df_t['발생건수대비 검거건수(%)'].iloc[-3]), 
                     xytext=(len(df_t)-4, df_t['발생건수대비 검거건수(%)'].iloc[-3] - 10),
                     arrowprops=dict(facecolor='royalblue', shrink=0.05, alpha=0.7, connectionstyle="arc3,rad=0.2"),
                     fontsize=14, color='royalblue', fontweight='bold')


    # 전체 레이아웃을 깔끔하게 조정합니다.
    plt.tight_layout(rect=[0, 0, 1, 0.97])

    # 그래프를 화면에 보여줍니다.
    plt.show()
```

## 1-2. 데이터 설명

## 
* 대구광역시 CCTV 정보 
* 대구광역시 안전비상벨 위치정보
* 대구광역시 유흥주점 현황
* 대구광역시 가로등 현황
* 대구광역시 보안등 현황
* 대구광역시 상가정보
* 대구광역시 관서별 경찰서 위치
* 대구광역시 치안센터 위치
* 대구광역시 학교 위치
* 대구광역시 대학교 위치
* 대구광역시 동.읍.면별 세대 및 인구
* 전국 범죄 발생 지역별 통계 데이터 (2023년)
* 직전 동분기 대비 분기별 범죄 데이터 (2025년)

## 최종 데이터셋 구성 {#sec-final-dataset}

인구통계 변수 (11개) {#sec-demo-vars}

| 변수명 | 설명 |
|--------|------|
| 세대수 (세대) | 행정동별 총 세대수 |
| 등록인구 (명) | 총 등록인구 (남/여 구분) |
| 한국인 (명) | 한국인 인구 (남/여 구분) |
| 외국인 (명) | 외국인 인구 (남/여 구분) |
| 세대당 인구 (명) | 평균 세대당 인구수 |
| 65세이상고령자 (명) | 고령자 인구 |
| 평균연령 (세) | 행정동 평균연령 |
| 인구밀도 (명/km^2) | 단위면적당 인구밀도 |
| 면적 (㎢) | 행정동 면적 |

## 안전 인프라 변수 (6개) {#sec-safety-vars}

| 변수명 | 설명 |
|--------|------|
| 경찰서 수 | 경찰서, 파출소, 지구대, 치안센터 총계 |
| 가로등 수 | 행정동 내 가로등 설치 개수 |
| 보안등 수 | 행정동 내 보안등 설치 개수 |
| 어린이용 CCTV 수 | 어린이 보호구역 CCTV 개수 |
| 방범용 CCTV수 | 방범목적 CCTV 설치 개수 |
| 안전비상벨 수 | 안전비상벨 설치 개수 |

## 지역 특성 변수 (5개) {#sec-region-vars}

| 변수명 | 설명 |
|--------|------|
| 유흥업소 수 | 행정동 내 유흥주점 개수 |
| 초등학교 수 | 초등학교 개수 |
| 중,고등학교 수 | 중학교, 고등학교 개수 |
| 대학교 수 | 대학교 개수 |
| 상가 수 | 상업시설 개수 |

## 종속 변수 (1개)

| 변수명 | 설명 |
|--------|------|
| 범죄발생 수 | 총 범죄수 * 총 인구수 / 구 인구수  |

## 2. 본론

## 2-1. 상관관계 히트맵

## 2-2. 가중치 설정

## 2-3. 위험수치 / 안전수치 계산

## 2-4. 동별 순 위험도 계산

## 2-5. 순위험도 지도

## 3. 결론

